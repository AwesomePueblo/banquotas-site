<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Whack-a-Meteors</title>
<style>
  :root { --accent: #007BA7; /* cerulean */ --bg:#0b0f14; --card:#121820; --text:#eaf2f7; --hit:#24d17e; --miss:#ff5a5f; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--text); }
  .wrap { max-width: 540px; margin: 24px auto; padding: 16px; }
  .card { background: var(--card); border: 1px solid rgba(255,255,255,.08); border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.2); }
  h1 { font-size: 22px; margin: 0 0 12px; display:flex; gap:8px; align-items:center; }
  .badge { font-size: 12px; color:#fff; background: var(--accent); padding: 2px 8px; border-radius: 999px; }
  .hud { display:flex; justify-content: space-between; gap: 12px; margin: 8px 0 14px; flex-wrap: wrap; }
  .hud .pill { background: rgba(255,255,255,.06); padding: 8px 10px; border-radius: 12px; min-width: 90px; text-align:center; }
  .grid { display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .cell { position: relative; aspect-ratio: 1 / 1; border-radius: 14px; overflow: hidden; background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.07); }
  .hole { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
  .meteor { width: 66%; height: 66%; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #ffdd76, #ff9f43 60%, #ff6a00 100%); transform: scale(0); transition: transform 80ms ease-out; box-shadow: 0 6px 16px rgba(255,140,0,.35); }
  .hole.active .meteor { transform: scale(1); }
  .hole.hit { animation: hitflash .25s; }
  @keyframes hitflash { 0%{box-shadow: inset 0 0 0 0 var(--hit);} 100%{box-shadow: inset 0 0 0 120px transparent;} }

  .controls { display:flex; gap:10px; margin-top:14px; }
  button { flex:1; border: none; background: var(--accent); color:#fff; padding:12px 14px; border-radius: 12px; font-weight: 600; font-size:16px; cursor:pointer; touch-action: manipulation; }
  button.secondary { background: transparent; border:1px solid rgba(255,255,255,.18); }
  .msg { margin-top: 10px; color: #c8d7e1; text-align:center; min-height: 22px; }
  .lives { letter-spacing: 2px; }
  .pulse { animation: pulse 0.8s ease; }
  @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.06)} 100%{transform:scale(1)} }

  /* Make it comfy on tiny phones */
  @media (max-width: 380px) {
    .wrap { padding: 12px; }
    .hud .pill { flex:1; }
  }
</style>
</head>
<body>
  <main class="wrap">
    <section id="meteor-game" class="card" aria-label="Whack-a-Meteors">
      <h1>Whack-a-Meteors <span class="badge">Mobile-Ready</span></h1>

      <div class="hud" role="status" aria-live="polite">
        <div class="pill">Score: <strong id="score">0</strong></div>
        <div class="pill">Best: <strong id="best">0</strong></div>
        <div class="pill">Level: <strong id="level">1</strong></div>
        <div class="pill">Lives: <strong id="lives" class="lives">♥♥♥</strong></div>
      </div>

      <div class="grid" id="grid" aria-label="Meteor grid">
        <!-- 3x3 cells -->
        <div class="cell"><div class="hole" data-idx="0"><div class="meteor" aria-hidden="true"></div></div></div>
        <div class="cell"><div class="hole" data-idx="1"><div class="meteor" aria-hidden="true"></div></div></div>
        <div class="cell"><div class="hole" data-idx="2"><div class="meteor" aria-hidden="true"></div></div></div>
        <div class="cell"><div class="hole" data-idx="3"><div class="meteor" aria-hidden="true"></div></div></div>
        <div class="cell"><div class="hole" data-idx="4"><div class="meteor" aria-hidden="true"></div></div></div>
        <div class="cell"><div class="hole" data-idx="5"><div class="meteor" aria-hidden="true"></div></div></div>
        <div class="cell"><div class="hole" data-idx="6"><div class="meteor" aria-hidden="true"></div></div></div>
        <div class="cell"><div class="hole" data-idx="7"><div class="meteor" aria-hidden="true"></div></div></div>
        <div class="cell"><div class="hole" data-idx="8"><div class="meteor" aria-hidden="true"></div></div></div>
      </div>

      <div class="controls">
        <button id="startBtn">Start</button>
        <button id="pauseBtn" class="secondary">Pause</button>
      </div>
      <div class="msg" id="msg" aria-live="polite">Tap meteors as they appear. Misses cost a life.</div>
    </section>
  </main>

<script>
(() => {
  const grid = document.getElementById('grid');
  const holes = Array.from(grid.querySelectorAll('.hole'));
  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');
  const levelEl = document.getElementById('level');
  const livesEl = document.getElementById('lives');
  const msgEl   = document.getElementById('msg');
  const startBtn= document.getElementById('startBtn');
  const pauseBtn= document.getElementById('pauseBtn');

  // Persistent high score
  const LS_KEY = 'meteor_best_score_v1';
  let best = parseInt(localStorage.getItem(LS_KEY) || '0', 10);
  bestEl.textContent = best;

  // Game state
  let score=0, level=1, lives=3, activeIdx=-1, timer=null, paused=false, running=false;
  let showTimeMs = 900; // starting visible time per meteor
  const minShowMs = 380; // fastest
  const levelStep = 5;   // points per level
  const vibrate = (ms)=> { try { if (navigator.vibrate) navigator.vibrate(ms);} catch(e){} };

  function reset() {
    clearTimers();
    score=0; level=1; lives=3; activeIdx=-1; paused=false; running=false;
    showTimeMs=900;
    updateHUD();
    holes.forEach(h=>h.classList.remove('active','hit'));
    msgEl.textContent = 'Tap meteors as they appear. Misses cost a life.';
    startBtn.textContent = 'Start';
    pauseBtn.textContent = 'Pause';
  }

  function updateHUD() {
    scoreEl.textContent = score;
    levelEl.textContent = level;
    livesEl.textContent = '♥'.repeat(lives);
  }

  function clearTimers(){ if (timer) { clearTimeout(timer); timer=null; } }

  function nextMeteor() {
    if (!running || paused) return;
    // deactivate previous
    if (activeIdx >= 0) {
      // If previous was still active, it counts as a miss
      holes[activeIdx].classList.remove('active');
      loseLife();
      if (!running) return; // ended
    }
    // pick a new index not equal to previous
    let idx;
    do { idx = Math.floor(Math.random()*holes.length); } while (idx === activeIdx);
    activeIdx = idx;
    holes[idx].classList.add('active');
    // hide after showTimeMs if not tapped
    timer = setTimeout(() => {
      if (!running || paused) return;
      holes[idx].classList.remove('active');
      if (activeIdx === idx) { // still same => missed
        loseLife();
        if (!running) return;
      }
      scheduleNext();
    }, showTimeMs);
  }

  function scheduleNext() {
    if (!running || paused) return;
    // small random gap to prevent rhythm-hacking
    const gap = 120 + Math.random()*120;
    timer = setTimeout(nextMeteor, gap);
  }

  function loseLife() {
    lives--;
    vibrate(20);
    livesEl.classList.add('pulse');
    setTimeout(()=>livesEl.classList.remove('pulse'), 260);
    updateHUD();
    if (lives <= 0) endGame();
  }

  function hit(idx) {
    if (!running || paused) return;
    if (idx !== activeIdx) return; // tap on empty hole
    // score and speed up
    score++;
    if (score % levelStep === 0 && showTimeMs > minShowMs) {
      level++;
      showTimeMs = Math.max(minShowMs, showTimeMs - 70);
      levelEl.classList.add('pulse');
      setTimeout(()=>levelEl.classList.remove('pulse'), 260);
    }
    updateHUD();
    const h = holes[idx];
    h.classList.add('hit');
    setTimeout(()=>h.classList.remove('hit'), 220);
    h.classList.remove('active');
    activeIdx = -1;
    vibrate(8);

    if (score > best) {
      best = score; bestEl.textContent = best;
      localStorage.setItem(LS_KEY, String(best));
    }
    // chain next meteor quickly
    clearTimers();
    timer = setTimeout(nextMeteor, 100);
  }

  function startGame() {
    if (running && !paused) return;
    if (!running) {
      running = true;
      msgEl.textContent = 'Go!';
      startBtn.textContent = 'Restart';
      holes.forEach(h=>h.classList.remove('active','hit'));
      activeIdx = -1;
      nextMeteor();
    } else if (paused) {
      paused = false;
      msgEl.textContent = 'Resumed';
      pauseBtn.textContent = 'Pause';
      scheduleNext();
    }
  }

  function pauseGame() {
    if (!running) return;
    paused = !paused;
    if (paused) {
      clearTimers();
      msgEl.textContent = 'Paused';
      pauseBtn.textContent = 'Resume';
    } else {
      msgEl.textContent = 'Resumed';
      pauseBtn.textContent = 'Pause';
      scheduleNext();
    }
  }

  function endGame() {
    running = false; paused = false;
    clearTimers();
    holes.forEach(h=>h.classList.remove('active'));
    activeIdx = -1;
    msgEl.textContent = `Game over · Score ${score} · Best ${best} — tap Start to play again`;
    startBtn.textContent = 'Start';
  }

  // Input: use pointer events for perfect mobile behavior
  holes.forEach(hole => {
    hole.addEventListener('pointerdown', (e) => {
      e.preventDefault();
      const idx = parseInt(hole.dataset.idx, 10);
      hit(idx);
    }, { passive: false });
  });

  startBtn.addEventListener('click', () => {
    // if already running and not paused => restart fresh
    if (running && !paused) {
      reset(); startGame();
    } else {
      startGame();
    }
  });
  pauseBtn.addEventListener('click', pauseGame);

  // Prevent double-tap zoom on iOS
  let lastTouch = 0;
  document.addEventListener('touchend', function(e){
    const now = Date.now();
    if (now - lastTouch < 350) e.preventDefault();
    lastTouch = now;
  }, { passive:false });

  // Initialize
  reset();
})();
</script>
</body>
</html>